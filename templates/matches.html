{% extends "base.html" %}
{% block title %}Zápasy{% endblock %}

{% block content %}
<div class="page">
  <div class="page__header">
    <div class="page__titles">
      <span class="page__kicker">Sezóna 2025/2026</span>
      <h2 class="page__title">Zápasy</h2>
      <p class="page__subtitle">Plán a výsledky zápasov tímu.</p>
    </div>
  </div>

  <!-- Formulár pre pridanie zápasu (Len pre Admina/Trénera) -->
  {% if user and (user.role == 'admin' or user.role == 'coach') %}
  <div class="card form-card stack-md" style="margin-bottom: 2rem;">
      <h3>Naplánovať nový zápas</h3>
      <form method="post" action="{{ url_for('create_match_post') }}" style="flex-direction: row; flex-wrap: wrap; align-items: flex-end; gap: 1rem;">
          <label>
              Súper
              <input type="text" name="opponent" placeholder="FC Barcelona" required>
          </label>
          <label>
              Miesto
              <input type="text" name="location" placeholder="Doma / Vonku" required>
          </label>
          <label>
              Dátum a čas
              <input type="datetime-local" name="date" required>
          </label>
          <button type="submit" class="button">Pridať zápas</button>
      </form>
  </div>
  {% endif %}

  <!-- Zoznam zápasov -->
  <div class="card table-card stack-md">
    <h3 style="margin:0;">Rozpis zápasov</h3>
    {% if matches|length == 0 %}
      <p style="margin:0; color: var(--muted);">Zatiaľ nie sú naplánované žiadne zápasy.</p>
    {% else %}
      <table class="data">
        <thead>
            <tr>
                <th>Dátum</th>
                <th>Súper</th>
                <th>Miesto</th>
                <th>Výsledok</th>
                {% if user and user.role == 'player' %}<th>Moja účasť</th>{% endif %}

                {% if user and (user.role == 'admin' or user.role == 'coach') %}<th>Akcie</th>{% endif %}
            </tr>
        </thead>
        <tbody>
        {% for m in matches %}
          <tr>
              <td>{{ m.date.replace("T", " ") }}</td>
              <td><strong>vs {{ m.opponent }}</strong></td>
              <td>{{ m.location }}</td>
              <td>
                  {% if m.home_score is not none and m.away_score is not none %}
                    <span style="font-weight: bold; background: #eee; padding: 2px 6px; border-radius: 4px;">
                        {{ m.home_score }}:{{ m.away_score }}
                    </span>
                  {% else %}
                    <span style="color: #999;">-:-</span>
                  {% endif %}
              </td>
              {% if user and user.role == 'player' %}
              <td>
                  <form method="post" action="{{ url_for('toggle_attendance_post', match_id=m.id) }}">
                      {% if m.attendance_confirmed %}
                        <button type="submit" style="background: #d1fae5; color: #065f46; padding: 0.3rem 0.8rem; font-size: 0.8rem; border:1px solid #a7f3d0; border-radius:15px; cursor:pointer; transition: all 0.2s;">
                            ✓ Potvrdené
                        </button>
                      {% else %}
                        <button type="submit" style="background: #fff; color: #6b7280; padding: 0.3rem 0.8rem; font-size: 0.8rem; border:1px solid #d1d5db; border-radius:15px; cursor:pointer; transition: all 0.2s;">
                            Potvrdiť účasť
                        </button>
                      {% endif %}
                  </form>
              </td>
              {% endif %}
              {% if user and (user.role == 'admin' or user.role == 'coach') %}
              <td>
                  <div style="display:flex; gap:0.5rem;">
                      <a href="{{ url_for('edit_match_ui', match_id=m.id) }}" style="padding: 0.3rem 0.8rem; background: #e0f2fe; color: #0369a1; text-decoration:none; font-size: 0.7rem; border-radius:4px;">Upraviť</a>

                      <form method="post" action="{{ url_for('delete_match_post', match_id=m.id) }}" onsubmit="return confirm('Naozaj vymazať tento zápas?');" style="margin:0;">
                          <button type="submit" style="padding: 0.3rem 0.8rem; background: #fee2e2; color: #991b1b; font-size: 0.7rem; border:none; border-radius:4px; cursor:pointer;">Zmazať</button>
                      </form>
                  </div>
              </td>
              {% endif %}
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
</div>
{% endblock %}