{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page dashboard">

  {% if not user %}
  <div class="card gradient-card" style="text-align: center; padding: 13.25rem 2rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">Vitajte v klube FC Mendelu</h1>
      <p style="margin-bottom: 2rem;">Pre pr√≠stup k rozpisu z√°pasov, tr√©ningom a ≈°tatistik√°m sa pros√≠m prihl√°ste.</p>
      <a href="{{ url_for('login_ui') }}" class="button big-black-button">Prihl√°si≈• sa</a>
  </div>

  {% else %}

  <div class="dashboard__header">
    <div class="dashboard__titles">
      <span class="dashboard__kicker">Prehƒæad</span>
      <h2 class="dashboard__title">Vitaj sp√§≈•, {{ user.username }}!</h2>
      <p class="dashboard__subtitle">Tu je prehƒæad toho najd√¥le≈æitej≈°ieho pre teba.</p>
    </div>
    <div class="dashboard__actions">
        <a href="{{ url_for('profile_ui') }}" class="button" style="background: white; color: var(--text); border: 1px solid #ddd;">M√¥j profil</a>
    </div>
  </div>

  {% if user.role == 'admin' %}

  <div class="summary-grid">
      <div class="card mini-card gradient-card">
          <span class="card__label">Registrovan√≠ hr√°ƒçi</span>
          <div class="card__value">{{ data.players_count }}</div>
          <small>Akt√≠vna s√∫piska</small>
      </div>
      <div class="card mini-card">
          <span class="card__label">V≈°etky z√°pasy</span>
          <div class="card__value">{{ data.matches_count }}</div>
          <a href="{{ url_for('matches_ui') }}" style="font-size:0.8rem; color: var(--accent);">Spravova≈• z√°pasy &rarr;</a>
      </div>
      <div class="card mini-card">
          <span class="card__label">Tr√©ningy</span>
          <div class="card__value">{{ data.trainings_count }}</div>
          <a href="{{ url_for('trainings_ui') }}" style="font-size:0.8rem; color: var(--accent);">Rozpis tr√©ningov &rarr;</a>
      </div>
  </div>

  <div class="card stack-md">
      <h3>R√Ωchle akcie</h3>
      <div style="display:flex; gap:1rem; flex-wrap:wrap;">
          <a href="{{ url_for('create_player_ui') }}" class="button">Prida≈• hr√°ƒça</a>
          <a href="{{ url_for('create_match_post') }}" onclick="alert('Pou≈æi sekciu Z√°pasy na pridanie'); return false;" class="button" style="background:#eee; color:#333;">Prida≈• z√°pas</a>
      </div>
  </div>

  {% elif user.role == 'coach' %}

  <div class="dashboard__columns">
      <div class="dashboard__column dashboard__column--left">
          <h3 style="margin-bottom:0.5rem;">ƒåo ≈•a ƒçak√°</h3>

          <div class="dashboard__row">
              <div class="card stack-md" style="flex:1;">
                  <span class="card__label" style="color:var(--accent);">Najbli≈æ≈°√≠ z√°pas</span>
                  {% if data.next_match %}
                    <div>
                        <div class="card__value" style="font-size:1.5rem; margin-bottom:0.2rem;">{{ data.next_match.opponent }}</div>
                        <div style="color:var(--muted); font-size:0.9rem;">
                            <span class="material-symbols-outlined" style="font-size:1rem; vertical-align:text-bottom;">calendar_today</span>
                            {{ data.next_match.date.replace('T', ' ') }}
                        </div>
                        <div style="color:var(--muted); font-size:0.9rem;">
                             <span class="material-symbols-outlined" style="font-size:1rem; vertical-align:text-bottom;">location_on</span>
                             {{ data.next_match.location }}
                        </div>
                    </div>
                    <div style="margin-top:auto;">
                        <a href="{{ url_for('manage_match_ui', match_id=data.next_match.id) }}" class="button" style="font-size:0.8rem;">Spravova≈• s√∫pisku</a>
                    </div>
                  {% else %}
                    <p style="color:var(--muted);">≈Ωiadne napl√°novan√© z√°pasy.</p>
                    <a href="{{ url_for('matches_ui') }}" class="button">Napl√°nova≈• z√°pas</a>
                  {% endif %}
              </div>

              <div class="card stack-md" style="flex:1;">
                  <span class="card__label" style="color:#2563eb;">Najbli≈æ≈°√≠ tr√©ning</span>
                  {% if data.next_training %}
                    <div>
                        <div class="card__value" style="font-size:1.5rem; margin-bottom:0.2rem;">{{ data.next_training.location }}</div>
                        <div style="color:var(--muted); font-size:0.9rem;">
                            {{ data.next_training.date.replace('T', ' ') }}
                        </div>
                        {% if data.next_training.description %}
                        <p style="font-size:0.85rem; color:#555; margin-top:0.5rem;">{{ data.next_training.description }}</p>
                        {% endif %}
                    </div>
                  {% else %}
                    <p style="color:var(--muted);">≈Ωiadne tr√©ningy.</p>
                    <a href="{{ url_for('trainings_ui') }}" class="button">Prida≈• tr√©ning</a>
                  {% endif %}
              </div>
          </div>
      </div>

      <div class="dashboard__column dashboard__column--right">
          <div class="card mini-card">
              <span class="card__label">Poƒçet hr√°ƒçov</span>
              <div class="card__value">{{ data.players_count }}</div>
              <a href="{{ url_for('players_ui') }}" style="font-size:0.8rem;">Zobrazi≈• t√≠m &rarr;</a>
          </div>
          <div class="card mini-card">
               <span class="card__label">Z√°pasov v sez√≥ne</span>
               <div class="card__value">{{ data.matches_count }}</div>
          </div>
      </div>
  </div>

  {% elif user.role == 'player' %}

  <div class="dashboard__columns">
      <div class="dashboard__column dashboard__column--left">
          <h3 style="margin-bottom:0.5rem;">Tvoj najbli≈æ≈°√≠ program</h3>

          {% if data.upcoming_events %}
            {% for event in data.upcoming_events[:3] %}
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding: 1rem 1.5rem;">
                <div>
                    <div style="font-size:0.75rem; text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.25rem;
                                color: {% if event.type == 'match' %}var(--accent){% else %}#2563eb{% endif %}; font-weight:bold;">
                        {% if event.type == 'match' %}Z√°pas{% else %}Tr√©ning{% endif %}
                    </div>
                    <div style="font-weight:700; font-size:1.1rem; margin-bottom:0.2rem;">{{ event.title.replace('Z√°pas: ', '').replace('Tr√©ning: ', '') }}</div>
                    <div style="color:var(--muted); font-size:0.9rem;">
                        <span class="material-symbols-outlined" style="font-size:1rem; vertical-align:text-bottom;">schedule</span>
                        {{ event.date.replace('T', ' ') }}
                    </div>
                </div>

                <div>
                    {% if event.type == 'match' %}
                         <form action="{{ url_for('toggle_attendance_post', match_id=event.event_id) }}" method="post">
                             {% if event.confirmed %}
                                <button type="submit" class="button" style="background:#ccffd6; color:#019115;">Potvrden√© ‚úì</button>
                             {% else %}
                                <button type="submit" class="button" style="background:#fee2e2; color:#991b1b;">Nepotvrden√©</button>
                             {% endif %}
                         </form>
                    {% else %}
                         <div style="background:#f3f4f6; padding:0.5rem 1rem; border-radius:999px; font-size:0.8rem; color:#555;">
                             √öƒças≈•
                         </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            {% if data.upcoming_events|length > 3 %}
                <div style="text-align:center; margin-top:1rem;">
                    <a href="{{ url_for('profile_ui') }}" style="color:var(--accent); font-weight:600;">Zobrazi≈• v≈°etky udalosti &rarr;</a>
                </div>
            {% endif %}

          {% else %}
            <div class="card chart-placeholder">
                <p>Moment√°lne ≈•a neƒçakaj√∫ ≈æiadne z√°pasy ani tr√©ningy.</p>
                <p>U≈æi si voƒæno! üèñÔ∏è</p>
            </div>
          {% endif %}
      </div>

      <div class="dashboard__column dashboard__column--right">
          <div class="card gradient-card">
              <span class="card__label" style="color:rgba(255,255,255,0.8);">M√¥j profil</span>
              <h3 style="margin: 0.5rem 0 1rem;">{{ user.first_name }} {{ user.last_name }}</h3>
              <p style="font-size:0.9rem; margin:0;">{{ user.position if user.position else 'Hr√°ƒç' }}</p>
          </div>
      </div>
  </div>

  {% endif %} {% endif %} </div>
{% endblock %}